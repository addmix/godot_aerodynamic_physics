[gd_scene load_steps=14 format=3 uid="uid://cpbp7en0cerjl"]

[ext_resource type="Script" uid="uid://b63k67778qs5n" path="res://addons/godot_aerodynamic_physics/core/aero_atmosphere_3d/aero_water_atmosphere_3d/aero_water_atmosphere_3d.gd" id="1_2sti6"]

[sub_resource type="GDScript" id="GDScript_2sti6"]
script/source = "extends Node3D

# This script isn't necessary for aerodynamics to work
# I just don't want to add these demo-controls to the project settings

func _ready():
	add_input(\"pitch_up\", KEY_S)
	add_input(\"pitch_down\", KEY_W)
	add_input(\"yaw_left\", KEY_Q)
	add_input(\"yaw_right\", KEY_E)
	add_input(\"roll_left\", KEY_A)
	add_input(\"roll_right\", KEY_D)
	add_input(\"throttle_up\", KEY_SHIFT)
	add_input(\"throttle_down\", KEY_CTRL)
	add_input(\"brake_up\", KEY_B)
	add_input(\"brake_down\", -1)
	add_input(\"tilt_up\", KEY_C)
	add_input(\"tilt_down\", KEY_V)
	add_input(\"collective_up\", KEY_T)
	add_input(\"collective_down\", KEY_G)

func add_input(_name : String, keycode : int) -> void:
	if InputMap.has_action(_name):
		return
	
	InputMap.add_action(_name)
	
	if keycode != -1:
		var input = InputEventKey.new()
		input.keycode = keycode
		InputMap.action_add_event(_name, input)
"

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_lajrc"]
sky_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)
ground_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)

[sub_resource type="Sky" id="Sky_dsdc3"]
sky_material = SubResource("ProceduralSkyMaterial_lajrc")

[sub_resource type="Environment" id="Environment_bkiet"]
background_mode = 2
sky = SubResource("Sky_dsdc3")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="FastNoiseLite" id="FastNoiseLite_ty4ai"]
frequency = 0.2125

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_rutke"]
noise = SubResource("FastNoiseLite_ty4ai")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_1sawy"]
albedo_color = Color(0, 0.490196, 0.0823529, 1)
albedo_texture = SubResource("NoiseTexture2D_rutke")

[sub_resource type="GDScript" id="GDScript_bs15r"]
script/source = "extends Marker3D

var vehicles := {
	\"Demo plane\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/demo_plane.tscn\",
	\"Cessna 172\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/cessna172/cessna172.tscn\",
	\"F-14 Tomcat\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/f14/f14.tscn\",
	\"F-14 Tomcat Mouse Control\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/f14/f14_mouse_control.tscn\",
	\"AIM-9 Sidewinder\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/missile/aim-9.tscn\",
	\"Quadcopter\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/quadcopter.tscn\",
	\"Su-57 \\\"Felon\\\"\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/su57/su57.tscn\",
	\"Su-47 \\\"Berkut\\\" \" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/berkut/berkut.tscn\",
	\"B-2 Spirit\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/b2/b2.tscn\",
	\"V-22 Osprey\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/tilt_rotor/v22.tscn\",
	\"UH-60 \\\"Blackhawk\\\"\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/blackhawk/blackhawk.tscn\",
	\"Boat\" : \"res://addons/godot_aerodynamic_physics/demo/aircraft_examples/boat/boat.tscn\",
}

var water_spawns : Array[String] = [
	\"Boat\",
]

func _ready() -> void:
	for key in vehicles.keys():
		$Control/VBoxContainer/OptionButton.add_item(key)

func _unhandled_input(event: InputEvent) -> void:
	if event is InputEventKey and event.keycode == KEY_F5:
		get_tree().reload_current_scene()

func _on_button_pressed() -> void:
	if $Control/VBoxContainer/OptionButton.selected == -1:
		return
	$Control.visible = false
	
	var vehicle_name : String = $Control/VBoxContainer/OptionButton.get_item_text($Control/VBoxContainer/OptionButton.selected)
	var vehicle_scene : PackedScene = load(vehicles[vehicle_name])
	var vehicle_instance : Node = vehicle_scene.instantiate()
	
	$\"..\".add_child(vehicle_instance)
	
	if vehicle_name in water_spawns:
		vehicle_instance.global_transform = $WaterSpawn.global_transform
	else:
		vehicle_instance.global_transform = global_transform
"

[sub_resource type="BoxShape3D" id="BoxShape3D_0xmma"]
size = Vector3(10000, 248.8212, 10000)

[sub_resource type="FastNoiseLite" id="FastNoiseLite_gngni"]
noise_type = 2
frequency = 0.0485
fractal_octaves = 3
fractal_lacunarity = 1.903
fractal_gain = -0.479
fractal_weighted_strength = 0.16
cellular_distance_function = 1
cellular_jitter = 1.455
cellular_return_type = 6
domain_warp_enabled = true
domain_warp_type = 1
domain_warp_amplitude = 11.435
domain_warp_frequency = 0.031
domain_warp_fractal_octaves = 2

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_ropp0"]
noise = SubResource("FastNoiseLite_gngni")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_koshk"]
albedo_color = Color(1.347661e-06, 0.38931048, 0.5508373, 1)
albedo_texture = SubResource("NoiseTexture2D_ropp0")
metallic_specular = 0.25
roughness = 0.14

[node name="Main" type="Node3D"]
script = SubResource("GDScript_2sti6")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.866023, -0.433016, 0.250001, 0, 0.499998, 0.866027, -0.500003, 0.749999, -0.43301, 0, 0, 0)
shadow_enabled = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_bkiet")

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, -4151.119999999995)
use_collision = true
size = Vector3(10000, 1, 10000)
material = SubResource("StandardMaterial3D_1sawy")

[node name="VehicleSpawner" type="Marker3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.14208106946543, 0)
script = SubResource("GDScript_bs15r")

[node name="Control" type="Control" parent="VehicleSpawner"]
layout_mode = 3
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -167.0
offset_top = -44.0
offset_right = 167.0
offset_bottom = 44.0
grow_horizontal = 2
grow_vertical = 2

[node name="VBoxContainer" type="VBoxContainer" parent="VehicleSpawner/Control"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="OptionButton" type="OptionButton" parent="VehicleSpawner/Control/VBoxContainer"]
layout_mode = 2
size_flags_vertical = 3

[node name="Button" type="Button" parent="VehicleSpawner/Control/VBoxContainer"]
layout_mode = 2
size_flags_vertical = 3
text = "Spawn"

[node name="Label" type="Label" parent="VehicleSpawner"]
anchors_preset = 12
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_top = -23.0
grow_horizontal = 2
grow_vertical = 0
text = "Press F5 to return to vehicle selection"
horizontal_alignment = 1

[node name="WaterSpawn" type="Marker3D" parent="VehicleSpawner"]
transform = Transform3D(-0.2588190451025207, 0, 0.9659258262890683, 0, 1, 0, -0.9659258262890683, 0, -0.2588190451025207, 0, 0, 991.9770866800802)

[node name="AeroWaterAtmosphere3D" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, 4059.1263203257226)
collision_layer = 0
collision_mask = 16384
monitorable = false
script = ExtResource("1_2sti6")
per_influencer_positioning = true
density = 1000.0
metadata/_custom_type_script = "uid://b63k67778qs5n"

[node name="CollisionShape3D" type="CollisionShape3D" parent="AeroWaterAtmosphere3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -124.41058492660522, 0)
shape = SubResource("BoxShape3D_0xmma")

[node name="CSGBox3D" type="CSGBox3D" parent="AeroWaterAtmosphere3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -124.58323287963869, 0)
size = Vector3(10000, 249.1665, 10000)
material = SubResource("StandardMaterial3D_koshk")

[connection signal="pressed" from="VehicleSpawner/Control/VBoxContainer/Button" to="VehicleSpawner" method="_on_button_pressed"]
